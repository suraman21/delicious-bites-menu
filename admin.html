<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Delicious Bites – Admin Panel</title>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}
    body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .login-container{background:#fff;padding:40px;border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,.1);width:100%;max-width:400px;text-align:center}
    .login-logo{font-size:3rem;margin-bottom:20px}
    .login-title{font-size:2rem;font-weight:800;margin-bottom:10px;color:#2d3436}
    .login-subtitle{color:#636e72;margin-bottom:30px}
    .login-form{display:flex;flex-direction:column;gap:20px}
    .form-group{text-align:left}
    label{display:block;margin-bottom:8px;font-weight:600;color:#2d3436}
    input,select,textarea{width:100%;padding:15px;border:2px solid #e9ecef;border-radius:10px;font-size:1rem;transition:border-color .3s}
    input:focus,select:focus,textarea:focus{outline:none;border-color:#667eea}
    .login-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;padding:15px;border-radius:10px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:transform .3s}
    .login-btn:hover{transform:translateY(-2px)}
    .error-message{color:#e74c3c;margin-top:10px;display:none}
    .admin-panel{display:none;width:100%;max-width:1200px;background:#fff;border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,.1);overflow:hidden}
    .admin-header{background:linear-gradient(135deg,#2d3436,#636e72);color:#fff;padding:30px;display:flex;justify-content:space-between;align-items:center}
    .admin-header h1{font-size:2rem;font-weight:800}
    .admin-content{padding:30px;max-height:80vh;overflow-y:auto}
    .sync-indicator{position:fixed;top:10px;right:10px;background:#ee5a24;color:#fff;padding:8px 15px;border-radius:20px;font-size:.8rem;font-weight:600;z-index:10000;display:none}
    .sync-indicator.syncing{background:#f39c12}.sync-indicator.success{background:#27ae60}.sync-indicator.error{background:#e74c3c}
    .supabase-status{background:#e8f4fd;padding:15px;border-radius:10px;margin-bottom:20px;border-left:4px solid #1976d2}
    .supabase-status.connected{background:#e8f5e8;border-left-color:#27ae60}
    .supabase-status.error{background:#fde8e8;border-left-color:#e74c3c}
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div class="login-container" id="loginContainer">
    <div class="login-logo">🍽️</div>
    <h1 class="login-title">Admin Panel</h1>
    <p class="login-subtitle">Delicious Bites Restaurant Management</p>

    <form class="login-form" id="loginForm">
      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" type="text" placeholder="Enter your username" required>
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="Enter your password" required>
      </div>
      <button type="submit" class="login-btn">Login to Dashboard</button>
      <div class="error-message" id="errorMessage">Invalid username or password.</div>
    </form>

    <div style="margin-top:30px;padding:15px;background:#f8f9fa;border-radius:10px;font-size:.9rem;color:#636e72">
      <strong>Default Credentials:</strong><br>
      Username: <code>admin</code><br>
      Password: <code>delicious2024</code>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="admin-panel" id="adminPanel">
    <div class="sync-indicator" id="syncIndicator">🔄 Syncing...</div>

    <div class="admin-header">
      <div>
        <h1>Menu Management Dashboard</h1>
        <p style="opacity:.8;margin-top:5px">Delicious Bites Restaurant</p>
      </div>
      <button id="logoutBtn" style="background:rgba(255,255,255,.2);color:#fff;border:none;padding:10px 20px;border-radius:50px;font-weight:600;cursor:pointer">Logout</button>
    </div>

    <div class="admin-content">
      <div class="supabase-status" id="supabaseStatus">
        <strong>🌐 Database Status:</strong> Connecting to Supabase…
      </div>

      <div>
        <h2>Total Items: <span id="totalItems">0</span></h2>
        <ul id="itemsList" style="margin-top:20px;padding-left:0;list-style:none"></ul>
      </div>
    </div>
  </div>

  <!-- Load Supabase SDK and your config -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>

  <script>
    // ========== SIMPLE LOGIN ==========
    const loginContainer = document.getElementById('loginContainer');
    const adminPanel = document.getElementById('adminPanel');
    const loginForm = document.getElementById('loginForm');
    const errorMessage = document.getElementById('errorMessage');
    const logoutBtn = document.getElementById('logoutBtn');
    const supabaseStatus = document.getElementById('supabaseStatus');
    const itemsList = document.getElementById('itemsList');
    const syncIndicator = document.getElementById('syncIndicator');
    const STORAGE_KEY='deliciousBitesAdminCredentials';
    const DEFAULT_CREDENTIALS={username:'admin',password:'delicious2024'};

    function loadCredentials(){const s=localStorage.getItem(STORAGE_KEY);return s?JSON.parse(s):DEFAULT_CREDENTIALS;}
    function saveCredentials(c){localStorage.setItem(STORAGE_KEY,JSON.stringify(c));}

    let ADMIN_CREDENTIALS=loadCredentials();

    loginForm.addEventListener('submit',e=>{
      e.preventDefault();
      const u=document.getElementById('username').value;
      const p=document.getElementById('password').value;
      if(u===ADMIN_CREDENTIALS.username&&p===ADMIN_CREDENTIALS.password){
        loginContainer.style.display='none';
        adminPanel.style.display='block';
        initAdminPanel();
      }else{
        errorMessage.style.display='block';
      }
    });

    logoutBtn.addEventListener('click',()=>{
      adminPanel.style.display='none';
      loginContainer.style.display='block';
      document.getElementById('username').value='';
      document.getElementById('password').value='';
    });

    // ========== SUPABASE DASHBOARD ==========
    async function testSupabaseConnection(){
      try{
        const {data,error}=await supabase.from('menu_items').select('*').limit(1);
        if(error) throw error;
        supabaseStatus.innerHTML='<strong>🌐 Database Status:</strong> <span style="color:#27ae60">Connected to Supabase</span>';
        supabaseStatus.className='supabase-status connected';
        return true;
      }catch(err){
        console.error('Connection failed:',err);
        supabaseStatus.innerHTML=`<strong>🌐 Database Status:</strong> <span style="color:#e74c3c">Connection failed – ${err.message}</span>`;
        supabaseStatus.className='supabase-status error';
        return false;
      }
    }

    async function loadMenuItems(){
      try{
        showSync('Loading menu items...','syncing');
        const {data,error}=await supabase.from('menu_items').select('*').order('id',{ascending:false});
        if(error) throw error;
        renderItems(data);
        showSync('✅ Menu loaded','success');
        setTimeout(hideSync,2000);
      }catch(err){
        console.error('Load error:',err);
        showSync('❌ Load failed','error');
        itemsList.innerHTML='<li style="color:#e74c3c;padding:10px">Database Connection Error</li>';
      }
    }

    function renderItems(data){
      document.getElementById('totalItems').textContent=data.length;
      itemsList.innerHTML='';
      data.forEach(it=>{
        const li=document.createElement('li');
        li.textContent=`${it.name} – ETB ${it.price}`;
        itemsList.appendChild(li);
      });
    }

    function showSync(text,type='syncing'){
      syncIndicator.textContent=text;
      syncIndicator.className=`sync-indicator ${type}`;
      syncIndicator.style.display='block';
    }
    function hideSync(){syncIndicator.style.display='none';}

    async function initAdminPanel(){
      const ok=await testSupabaseConnection();
      if(ok) await loadMenuItems();
    }

    document.addEventListener('DOMContentLoaded',()=>document.getElementById('username').focus());
  </script>
</body>
</html>
